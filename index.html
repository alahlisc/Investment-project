<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم المشروع الاستثماري - الأهلي</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #006400;
      --accent-color: #0a3d62;
      --success-color: #27ae60;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --info-color: #3498db;
      --card-bg: #fff;
      --light-bg: #f8f9fa;
      --border-radius: 10px;
      --box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    body { font-family: 'Cairo', sans-serif; background: var(--light-bg); margin:0; }
    header { background:linear-gradient(135deg,var(--primary-color),var(--accent-color)); color:white; padding:15px; text-align:center; }
    h1 { margin:0; font-size:1.6rem; }
    .container { max-width:1500px; margin:20px auto; padding:10px; }
    .nav-tabs { display:flex; flex-wrap:wrap; background:white; border-radius:var(--border-radius); overflow:hidden; margin-bottom:20px; box-shadow:var(--box-shadow); }
    .nav-tab { flex:1; min-width:120px; padding:12px; text-align:center; cursor:pointer; font-weight:600; background:#f8fafc; border-bottom:3px solid transparent; }
    .nav-tab.active { background:white; color:var(--primary-color); border-bottom:3px solid var(--primary-color); }
    .tab-content { display:none; animation:fadeIn .5s ease; }
    .tab-content.active { display:block; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    .stats-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; margin:20px 0; }
    .card { background:var(--card-bg); padding:15px; border-radius:var(--border-radius); box-shadow:var(--box-shadow); }
    .card-header { display:flex; justify-content:space-between; margin-bottom:10px; }
    .card-value { font-size:1.8rem; font-weight:bold; }
    .table-container { background:white; padding:15px; border-radius:var(--border-radius); box-shadow:var(--box-shadow); margin-top:15px; overflow-x:auto; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px; border-bottom:1px solid #ddd; text-align:center; }
    th { background:#f5f6f7; }
    .invoice-status { padding:4px 10px; border-radius:15px; font-size:0.8rem; font-weight:bold; }
    .status-ok { background:#e8f5e9; color:var(--success-color); }
    .status-review { background:#fff3cd; color:var(--warning-color); }
    .status-obligation { background:#f8d7da; color:var(--danger-color); }
    .search-box { margin-bottom:15px; display:flex; gap:10px; }
    .search-box input { flex:1; padding:8px; border:1px solid #ccc; border-radius:var(--border-radius); }
    .search-box button { padding:8px 15px; border:none; background:var(--primary-color); color:white; border-radius:var(--border-radius); cursor:pointer; }
    .payment-timeline { margin:15px 0; padding-left:20px; border-left:3px solid #ccc; }
    .payment-event { margin-bottom:10px; position:relative; }
    .payment-event::before { content:"•"; position:absolute; left:-18px; top:0; font-size:1.2rem; color:var(--primary-color); }
    .summary-item { margin:5px 0; }
  </style>
</head>
<body>
  <header><h1>لوحة تحكم المشروع الاستثماري - النادي الأهلي</h1></header>
  <div class="container">

    <!-- Tabs -->
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="dashboard">لوحة التحكم</div>
      <div class="nav-tab" data-tab="shops">إدارة المحلات</div>
      <div class="nav-tab" data-tab="tenants">تصنيف المستأجرين</div>
      <div class="nav-tab" data-tab="payments">الإيصال المالي</div>
      <div class="nav-tab" data-tab="prediction">تنبؤ الإيرادات</div>
      <div class="nav-tab" data-tab="annual">الجرد السنوي</div>
    </div>

    <!-- Dashboard -->
    <div class="tab-content active" id="dashboard">
      <h2>نظرة عامة</h2>
      <div class="stats-cards">
        <div class="card"><div class="card-header"><span>إجمالي المحلات</span><i class="fas fa-store"></i></div><div class="card-value" id="totalShops">0</div></div>
        <div class="card"><div class="card-header"><span>المستوفية</span><i class="fas fa-check-circle"></i></div><div class="card-value" id="completedShops">0</div></div>
        <div class="card"><div class="card-header"><span>غير المستوفية</span><i class="fas fa-exclamation-triangle"></i></div><div class="card-value" id="notCompletedShops">0</div></div>
        <div class="card"><div class="card-header"><span>الإيرادات</span><i class="fas fa-money-bill-wave"></i></div><div class="card-value" id="totalRevenue">0</div></div>
      </div>
      <canvas id="paymentChart" height="120"></canvas>
    </div>

    <!-- Shops -->
    <div class="tab-content" id="shops">
      <h2>إدارة المحلات</h2>
      <div class="table-container">
        <table>
          <thead><tr><th>رقم المحل</th><th>المرحلة</th><th>الدور</th><th>المستأجر</th><th>الإيجار</th><th>آخر سداد</th><th>الحالة</th></tr></thead>
          <tbody id="shopsTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Tenants -->
    <div class="tab-content" id="tenants">
      <h2>تصنيف المستأجرين</h2>
      <div class="stats-cards">
        <div class="card"><div class="card-header"><span>المكتملين</span></div><div class="card-value" id="completedTenants">0</div></div>
        <div class="card"><div class="card-header"><span>غير مكتملين</span></div><div class="card-value" id="notCompletedTenants">0</div></div>
        <div class="card"><div class="card-header"><span>تحت المراجعة</span></div><div class="card-value" id="underReviewTenants">0</div></div>
      </div>
    </div>

    <!-- Payments -->
    <div class="tab-content" id="payments">
      <h2>الإيصال المالي</h2>
      <div class="search-box">
        <input type="text" id="paymentSearchInput" placeholder="أدخل رقم المحل أو اسم المستأجر...">
        <button onclick="searchPayment()">بحث</button>
      </div>
      <div id="paymentDetails"></div>
    </div>

    <!-- Prediction -->
    <div class="tab-content" id="prediction">
      <h2>تنبؤ الإيرادات</h2>
      <canvas id="predictionChart" height="120"></canvas>
    </div>

    <!-- Annual -->
    <div class="tab-content" id="annual">
      <h2>الجرد السنوي</h2>
      <div class="stats-cards">
        <div class="card"><div class="card-header"><span>إجمالي الإيرادات السنوية</span></div><div class="card-value" id="yearlyRevenue">0</div></div>
        <div class="card"><div class="card-header"><span>متوسط الإيجار</span></div><div class="card-value" id="yearlyAvgRent">0</div></div>
      </div>
    </div>

  </div>

  <script>
    // روابط JSON (استبدل بروابط raw GitHub)
    const fullURL = "https://raw.githubusercontent.com/alahlisc/Investment-project/main/كامل_الالتزام_التعاقد_.json";
    const reviewURL = "https://raw.githubusercontent.com/alahlisc/Investment-project/main/المراجعة_القانونية.json";
    const obligationURL = "https://raw.githubusercontent.com/alahlisc/Investment-project/main/الالتزام.json";

    async function fetchData(url){ let r=await fetch(url); return await r.json(); }

    function fillTable(tbodyId,data,statusClass,statusText){
      const tbody=document.getElementById(tbodyId);
      tbody.innerHTML="";
      data.forEach(item=>{
        tbody.innerHTML+=`<tr>
          <td>${item["رقم المحل"]||"-"}</td>
          <td>${item["المرحلة"]||"-"}</td>
          <td>${item["الدور"]||"-"}</td>
          <td>${item["المستاجر "]||"-"}</td>
          <td>${item["الايجار"]||"-"}</td>
          <td>${item["تاريخ اخر سداد"]||"-"}</td>
          <td><span class="invoice-status ${statusClass}">${statusText}</span></td>
        </tr>`;
      });
    }

    async function loadAll(){
      window.fullData=await fetchData(fullURL);
      window.reviewData=await fetchData(reviewURL);
      window.obligationsData=await fetchData(obligationURL);

      // Dashboard
      document.getElementById("totalShops").textContent = fullData.length+reviewData.length+obligationsData.length;
      document.getElementById("completedShops").textContent = fullData.length;
      document.getElementById("notCompletedShops").textContent = obligationsData.length;
      document.getElementById("totalRevenue").textContent = fullData.reduce((s,i)=>s+(i["الايجار"]||0),0);

      new Chart(document.getElementById("paymentChart"),{
        type:"doughnut",
        data:{ labels:["مستوفٍ","مراجعة","التزام"],
          datasets:[{ data:[fullData.length,reviewData.length,obligationsData.length], backgroundColor:["#27ae60","#f39c12","#e74c3c"] }] }
      });

      // Tenants
      document.getElementById("completedTenants").textContent=fullData.length;
      document.getElementById("notCompletedTenants").textContent=obligationsData.length;
      document.getElementById("underReviewTenants").textContent=reviewData.length;

      // Prediction
      const currentRevenue = fullData.reduce((s,i)=>s+(i["الايجار"]||0),0);
      new Chart(document.getElementById("predictionChart"),{
        type:"bar",
        data:{ labels:["الإيراد الحالي","بعد الزيادة"], datasets:[{ data:[currentRevenue,currentRevenue*2], backgroundColor:["#3498db","#27ae60"]}] }
      });

      // Annual
      document.getElementById("yearlyRevenue").textContent = currentRevenue*12;
      document.getElementById("yearlyAvgRent").textContent = Math.round(currentRevenue/fullData.length);
    }

    function searchPayment(){
      const query = document.getElementById("paymentSearchInput").value.trim();
      if(!query){ alert("أدخل رقم المحل أو اسم المستأجر"); return; }

      let allData = [...window.fullData, ...window.reviewData, ...window.obligationsData];
      let result = allData.find(item =>
        (item["رقم المحل"] && item["رقم المحل"].toString() === query) ||
        (item["المستاجر "] && item["المستاجر "].includes(query))
      );

      const detailsDiv = document.getElementById("paymentDetails");
      if(result){
        let paid = result["القيمة المدفوعة "] || 0;
        let remain = result["الباقي"] || 0;
        let lastPay = result["تاريخ اخر سداد"] || "-";

        let timeline="";
        if(result["المدفوعات"] && Array.isArray(result["المدفوعات"])){
          timeline = result["المدفوعات"].map(pay =>
            `<div class="payment-event">📅 ${pay["تاريخ"]} - دفع ${pay["المبلغ"]} د.ل (إيصال: ${pay["رقم الايصال"]||"-"})</div>`
          ).join("");
        } else {
          timeline = `<div class="payment-event">📅 ${lastPay} - دفع ${paid} د.ل</div>`;
        }

        detailsDiv.innerHTML = `
          <h3>المستأجر: ${result["المستاجر "]||"-"}</h3>
          <p>المحل: ${result["رقم المحل"]||"-"} | المرحلة: ${result["المرحلة"]||"-"} | الدور: ${result["الدور"]||"-"}</p>
          <p>قيمة الإيجار: ${result["الايجار"]||"-"} د.ل</p>
          <div class="payment-timeline">${timeline}</div>
          <div class="summary-item"><strong>إجمالي مدفوع:</strong> ${paid} د.ل</div>
          <div class="summary-item"><strong>المتبقي:</strong> ${remain} د.ل</div>
          <div class="summary-item"><strong>الحالة:</strong> 
            <span class="invoice-status ${remain==0?"status-ok":remain>0?"status-obligation":"status-review"}">
              ${remain==0?"مستوفي":remain>0?"غير مكتمل":"مراجعة"}
            </span>
          </div>
          <button onclick="window.print()">🖨️ طباعة الإيصال</button>
        `;
      }else{
        detailsDiv.innerHTML = `<p style="color:red;">❌ لا يوجد بيانات لهذا المحل/المستأجر</p>`;
      }
    }

    // Tabs
    document.querySelectorAll(".nav-tab").forEach(tab=>{
      tab.addEventListener("click",()=>{
        document.querySelectorAll(".nav-tab").forEach(t=>t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.getAttribute("data-tab")).classList.add("active");
      });
    });

    loadAll();
  </script>
</body>
</html>
